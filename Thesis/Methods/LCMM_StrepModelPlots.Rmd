---
title: "Strep Model Plots"
author: "Casey Sakamoto"
date: "7/1/2020"
output: pdf_document
---

```{r setup, include=FALSE}
# load packages
library(tidyverse)
library(lcmm)
library(ggalluvial) # visualizing the class movements
library(Hmisc)
# load in models from strep models
load("~/strep_5quantsplines.RData")
describe(BONUS_lcmm$Age)
describe(BONUS_lcmm$agemos)
```

```{r trajectories}
# look at the trajectories of the 4 lc fit in the splines model
postprob(clrmod_3_spl_2)
postprob(clrmod_3_spl_3) # splits up class 2 into two parts; class 1 in prev model = class 2 in this
postprob(clrmod_3_spl_4) # looks like some of the big class is being split up

#plotfit
plot(clrmod_3_spl_4)
plot(clrmod_3_spl_4, which = "fit", var.time = "Age",
     xlab = "age", ylab = "normalized strep",  legend = NULL)
# prediction data set
BONUS_LCMM_pred = data.frame(age = seq(1, 12, length = 200))
```

```{r alluvial}
classes2 = clrmod_3_spl_2$pprob[,1:2] %>% rename(class2 = class) # to get the classes for alluvial plots
classes3 = clrmod_3_spl_3$pprob[,1:2] %>% rename(class3 = class)
classes4 = clrmod_3_spl_4$pprob[,1:2] %>% rename(class4 = class)

# make data frame for the classes
alluvial_df = full_join(classes2, classes3, by = "patient_id")
alluvial_df = full_join(alluvial_df, classes4, by = "patient_id")

# put into aluvial form
alluvial_df = alluvial_df %>% group_by(class2,class3,class4) %>% summarise( freq=n())
is_alluvia_form(alluvial_df, silent = T)

# ggplot

lc_alluvial = ggplot(data = alluvial_df, aes(y = freq, axis1 = class2, axis2 = class3, axis3 = class4)) + 
  geom_alluvium(aes(fill = class4), width = 0, knot.pos = 0, reverse = F) + 
  guides(fill = FALSE) + 
  geom_stratum(width = 1/8, reverse = FALSE) + 
  geom_text(stat = "stratum", infer.label = TRUE, reverse = FALSE) +
  scale_x_continuous(breaks = 1:3, labels = c("2 lc", "3 lc", "4 lc"))

### need to look at what the trajectories are like and assign labels to the groups to better understand what is happening
lc_alluvial

setwd("C:/Users/Casey/Desktop/WorkData/Thesis 2020")
ggsave("lcmm_alluvial.png", plot = lc_alluvial)
```
